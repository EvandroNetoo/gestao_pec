{% extends "schedule/gestao/base_gestao.html" %}

{% block title %}

    Alunos ‚Äî

{% endblock title %}

{% block gestao_content %}

    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
        <h1 class="text-2xl font-bold">Alunos</h1>
        <div class="flex gap-2">
            <a href="{% url 'aluno_bulk_create' %}" class="btn btn-secondary btn-sm">+ Adicionar em Lote</a>
            <a href="{% url 'aluno_create' %}" class="btn btn-primary btn-sm">+ Novo Aluno</a>
        </div>
    </div>

    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">

            <form method="get" class="flex flex-col sm:flex-row gap-2 mb-4">
                <input type="text"
                       name="q"
                       value="{{ q }}"
                       placeholder="Buscar aluno‚Ä¶"
                       class="input input-sm input-neutral flex-1" />
                <select name="turma" class="select select-sm select-neutral">
                    <option value="">Todas as turmas</option>

                    {% for turma in turmas %}

                        <option value="{{ turma.pk }}" 
                            {% if turma_filtro == turma.pk|stringformat:"d" %}selected{% endif %}>{{ turma }}</option>

                    {% endfor %}

                </select>
                <button type="submit" class="btn btn-sm btn-neutral">Filtrar</button>

                {% if q or turma_filtro %}

                    <a href="{% url 'aluno_list' %}" class="btn btn-sm btn-ghost">Limpar</a>

                {% endif %}

            </form>

            <div class="overflow-x-auto">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="text-left w-0">Nome</th>
                            <th class="text-center w-0">Turma</th>
                            <th>Oficinas</th>
                            <th class="text-center w-0">Presen√ßas</th>
                            <th class="text-center w-0">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for aluno in alunos %}

                            <tr>
                                <td>
                                    <a href="{% url 'aluno_detail' aluno.pk %}"
                                       class="link link-hover font-medium whitespace-nowrap">{{ aluno.nome }}</a>
                                </td>
                                <td class="text-center w-0">
                                    <span class="badge badge-ghost badge-sm whitespace-nowrap">{{ aluno.turma }}</span>
                                </td>
                                <td>

                                    {% for oficina in aluno.oficinas_fixas.all %}

                                        <span class="badge badge-sm badge-outline whitespace-nowrap">{{ oficina.nome }}</span>
                                    {% empty %}
                                        <span class="text-base-content/40">‚Äî</span>

                                    {% endfor %}
                                </td>
                                <td class="text-center w-0">
                                    <span class="badge badge-primary badge-sm">{{ aluno.total_presencas|default:0 }} pts</span>
                                </td>
                                <td class="text-center w-0">
                                    <div class="flex justify-end gap-1">
                                        <a href="{% url 'relatorio_aluno' aluno.pk %}"
                                           class="btn btn-ghost btn-xs"
                                           title="Relat√≥rio">üìä</a>
                                        <a href="{% url 'aluno_update' aluno.pk %}" class="btn btn-ghost btn-xs">‚úèÔ∏è</a>
                                        <a href="{% url 'aluno_delete' aluno.pk %}"
                                           class="btn btn-ghost btn-xs text-error">üóëÔ∏è</a>
                                    </div>
                                </td>
                            </tr>

                        {% empty %}

                            <tr>
                                <td colspan="5" class="text-center text-base-content/50 py-8">
                                    Nenhum aluno encontrado.
                                </td>
                            </tr>

                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock gestao_content %}
