{% extends "base.html" %}

{% load static %}

{% block title %}

    Agenda â€”

{% endblock title %}


{% block extrahead %}

    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.css"
          rel="stylesheet" />

{% endblock extrahead %}


{% block content %}

    <div class="navbar bg-base-100 shadow-sm px-2 sm:px-4">
        <div class="navbar-start gap-2">
            <span class="text-lg sm:text-xl font-bold">ðŸ“… Agenda PEC</span>
            <a href="{% url 'dashboard' %}" class="btn btn-ghost">GestÃ£o</a>
        </div>
        <div class="navbar-end">
            <div class="flex flex-wrap gap-1 sm:gap-2">
                <span class="badge badge-xs sm:badge-sm" style="background:#2563eb;color:#fff;">PeriÃ³dico</span>
                <span class="badge badge-xs sm:badge-sm" style="background:#c90c0f;color:#fff;">EsporÃ¡dico</span>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-2 sm:p-4 max-w-6xl">
        <div id="calendar" class="bg-base-100 rounded-box p-2 sm:p-4 shadow-sm"></div>
    </div>

    <div id="modal-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            const isMobile = window.innerWidth < 768;

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: isMobile ? 'listWeek' : 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: isMobile
                    ? { left: 'prev,next', center: 'title', right: 'listWeek,dayGridMonth' }
                    : { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek' },
                buttonText: {
                    today: 'Hoje',
                    month: 'MÃªs',
                    week: 'Semana',
                    day: 'Dia',
                    list: 'Lista'
                },
                events: '{% url "api_eventos" %}',
                eventClick: function(info) {
                    info.jsEvent.preventDefault();
                    htmx.ajax(
                        'GET',
                        '/evento/' + info.event.id + '/detalhes/', {
                            target: '#modal-container',
                            swap: 'innerHTML'
                        }
                    );
                },
                windowResize: function(view) {
                    const mobile = window.innerWidth < 768;
                    if (mobile && calendar.view.type === 'dayGridMonth') {
                        calendar.changeView('listWeek');
                    }
                },
                height: 'auto',
                navLinks: true,
                editable: false,
                dayMaxEvents: isMobile ? 2 : true,
                titleFormat: isMobile
                    ? { month: 'short', year: 'numeric' }
                    : { month: 'long', year: 'numeric' },
            });
            calendar.render();
        });
    </script>

    <style>
        @media (max-width: 767px) {
            .fc .fc-toolbar {
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            .fc .fc-toolbar-title {
                font-size: 1rem !important;
            }
            .fc .fc-button {
                padding: 0.2rem 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>

{% endblock content %}
